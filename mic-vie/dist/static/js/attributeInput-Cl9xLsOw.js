import{k as e,g as t,a as l}from"./vcc-_i_NI1Dm.js";import{_ as a,r as o,o as s,c as i,b as r,w as n,e as u,V as c,a as p,F as d,d as m,B as f,h,f as b,y as v,T as y,z as _,p as k,j as g}from"./index-P5OYZ-yC.js";import{s as j}from"./store-Dix8UNXL.js";const O=[{name:"输入框",label:"",valueName:"",value:"",type:"input",rule:{isRequire:!1,errorMessage:""},propsData:{},propsDataSelects:[{name:"最大长度",key:"maxlength",value:""},{name:"最小长度",key:"minlength",value:""},{name:"占位文本",key:"placeholder",value:""},{name:"是否可清空",key:"clearable",value:"false"},{name:"是否显示统计字数",key:"show-word-limit",value:""},{name:"是否显示密码图标",key:"show-password",value:""},{name:"类型",key:"type",value:""}]}],C={class:"attribute-seeting-box"},V={class:"attribute-seeting-content"},w={key:0,class:"l-form-b"},A={class:"icon-left"},x={class:"label"},S={class:"value"},I={class:"icon-right"},D={class:"flex"},N=["onClick"],B={key:0},R={class:"form-bottom"};const P={components:{styleComponent:a({},[["render",function(e,t){const l=o("el-divider");return s(),i("div",null,[r(l,{"content-position":"left"},{default:n((()=>[u("样式处理")])),_:1})])}]]),lFormA:a({components:{VNode:c},props:["localAttributes"],inject:["vccApp"],data:()=>({formArr:O,popObj:{},rules:{label:[{required:!0,message:"请输入名称",trigger:"blur"}],valueName:[{required:!0,message:"请输入绑定数据字段",trigger:"blur"}]},isShowFormAPop:!1,jsCode:"",formItem:[]}),mounted(){this.jsCode=this.vccApp.mainPanelProvider.getComponentOptions(),this.init(this.localAttributes)},methods:{init(e){e.forEach((e=>{":form"==e.key&&(this.formItem=this.jsCode.data()[e.value]||[],this.formItemKey=e.value)}))},formSelectBtn(e){e.stopPropagation()},selectBtn(e){let t=JSON.parse(JSON.stringify(O[e]));this.popObj=t,this.isShowFormAPop=!0},propsClick(e){this.popObj.propsData[e.key]=e.value||""},radioChage(e){e?this.rules.rule={errorMessage:[{required:!0,message:"请输入提示",trigger:"blur"}]}:delete this.rules.rule},deleteProps(e){delete this.popObj.propsData[e]},submitForm(e){return t=this,l=null,a=function*(){const t=this.$refs[e];t&&(yield t.validate(((e,t)=>{if(e){let e={label:this.popObj.label,valueName:this.popObj.valueName,value:this.popObj.value,type:this.popObj.type,rule:[],propsData:this.popObj.propsData};1==this.popObj.rule.isRequire&&e.rule.push({required:!0,message:this.popObj.rule.errorMessage}),this.formItem.push(e),this.viewSaveJs(),this.isShowFormAPop=!1}})))},new Promise(((e,o)=>{var s=e=>{try{r(a.next(e))}catch(t){o(t)}},i=e=>{try{r(a.throw(e))}catch(t){o(t)}},r=t=>t.done?e(t.value):Promise.resolve(t.value).then(s,i);r((a=a.apply(t,l)).next())}));var t,l,a},viewSaveJs(){let e={key:this.formItemKey,data:this.formItem};this.vccApp.viewSaveJs(e,"")}}},[["render",function(e,t,l,a,c,v){const y=o("el-divider"),_=o("RemoveFilled"),k=o("el-icon"),g=o("VNode"),j=o("Edit"),O=o("el-button"),P=o("el-popover"),M=o("el-input"),U=o("el-form-item"),F=o("el-radio"),q=o("el-radio-group"),z=o("Plus"),$=o("el-form"),J=o("el-dialog");return s(),i("div",C,[r(y,{"content-position":"left"},{default:n((()=>[u("自定义表单")])),_:1}),p("div",V,[c.formItem.length>0?(s(),i("div",w,[(s(!0),i(d,null,m(c.formItem,((e,t)=>(s(),i("div",{key:t,class:"l-form-b-li"},[p("div",A,[r(k,null,{default:n((()=>[r(_)])),_:1})]),p("div",x,f(e.label),1),p("div",S,[r(g,{content:e},null,8,["content"])]),p("div",I,[r(k,null,{default:n((()=>[r(j)])),_:1})])])))),128))])):h("",!0),r(P,{placement:"left-start",trigger:"hover"},{reference:n((()=>[r(O,null,{default:n((()=>[u("添加表单")])),_:1})])),default:n((()=>[p("div",{class:"form-select-btn",onClick:t[0]||(t[0]=(...e)=>v.formSelectBtn&&v.formSelectBtn(...e))},[(s(!0),i(d,null,m(c.formArr,((e,t)=>(s(),b(O,{key:t,onClick:e=>v.selectBtn(t)},{default:n((()=>[u(f(e.name),1)])),_:2},1032,["onClick"])))),128))])])),_:1})]),r(J,{modelValue:c.isShowFormAPop,"onUpdate:modelValue":t[9]||(t[9]=e=>c.isShowFormAPop=e),title:`添加表单${c.popObj.name}`},{default:n((()=>[r($,{ref:"ruleFormARef",model:c.popObj,rules:c.rules,"label-width":"auto","status-icon":""},{default:n((()=>[r(U,{label:"名称",prop:"label"},{default:n((()=>[r(M,{modelValue:c.popObj.label,"onUpdate:modelValue":t[1]||(t[1]=e=>c.popObj.label=e)},null,8,["modelValue"])])),_:1}),r(U,{label:"绑定数据字段",prop:"valueName"},{default:n((()=>[r(M,{modelValue:c.popObj.valueName,"onUpdate:modelValue":t[2]||(t[2]=e=>c.popObj.valueName=e)},null,8,["modelValue"])])),_:1}),r(U,{label:"默认值",prop:"value"},{default:n((()=>[r(M,{modelValue:c.popObj.value,"onUpdate:modelValue":t[3]||(t[3]=e=>c.popObj.value=e)},null,8,["modelValue"])])),_:1}),r(U,{label:"是否必填",prop:"popObj.rule.isRequire"},{default:n((()=>[r(q,{modelValue:c.popObj.rule.isRequire,"onUpdate:modelValue":t[4]||(t[4]=e=>c.popObj.rule.isRequire=e),onChange:v.radioChage},{default:n((()=>[r(F,{label:!1},{default:n((()=>[u("不必填")])),_:1}),r(F,{label:!0},{default:n((()=>[u("必填")])),_:1})])),_:1},8,["modelValue","onChange"])])),_:1}),c.popObj.rule.isRequire?(s(),b(U,{key:0,label:"必填提示",prop:"rule.errorMessage"},{default:n((()=>[r(M,{modelValue:c.popObj.rule.errorMessage,"onUpdate:modelValue":t[5]||(t[5]=e=>c.popObj.rule.errorMessage=e)},null,8,["modelValue"])])),_:1})):h("",!0),Object.keys(c.popObj.propsData).length>0?(s(!0),i(d,{key:1},m(c.popObj.propsDataSelects,((e,t)=>(s(),i(d,null,[Object.keys(c.popObj.propsData).indexOf(`${e.key}`)>-1?(s(),b(U,{key:t,label:e.name},{default:n((()=>[p("div",D,[r(M,{modelValue:c.popObj.propsData[e.key],"onUpdate:modelValue":t=>c.popObj.propsData[e.key]=t},null,8,["modelValue","onUpdate:modelValue"]),p("div",{class:"icon-right",onClick:t=>v.deleteProps(e.key)},[r(k,null,{default:n((()=>[r(_)])),_:1})],8,N)])])),_:2},1032,["label"])):h("",!0)],64)))),256)):h("",!0),r(U,null,{default:n((()=>[r(P,{placement:"right-start",trigger:"hover"},{reference:n((()=>[r(O,{type:"primary",circle:""},{default:n((()=>[r(k,null,{default:n((()=>[r(z)])),_:1})])),_:1})])),default:n((()=>[p("div",{class:"form-props-btn",onClick:t[6]||(t[6]=(...e)=>v.formSelectBtn&&v.formSelectBtn(...e))},[Object.keys(c.popObj.propsData).length==c.popObj.propsDataSelects.length?(s(),i("div",B,"无属性")):(s(!0),i(d,{key:1},m(c.popObj.propsDataSelects,((e,t)=>(s(),i(d,null,[-1==Object.keys(c.popObj.propsData).indexOf(`${e.key}`)?(s(),b(O,{key:t,onClick:t=>v.propsClick(e)},{default:n((()=>[u(f(e.name),1)])),_:2},1032,["onClick"])):h("",!0)],64)))),256))])])),_:1})])),_:1}),r(U,null,{default:n((()=>[p("div",R,[r(O,{type:"primary",onClick:t[7]||(t[7]=e=>v.submitForm("ruleFormARef"))},{default:n((()=>[u("保存")])),_:1}),r(O,{onClick:t[8]||(t[8]=e=>c.isShowFormAPop=!1)},{default:n((()=>[u("取消")])),_:1})])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}]])},props:["__rawVueInfo__","enableRemoveButton","shortcutInitMode","JSCode"],data:function(){return{input:"",localAttributes:[],enable:!0,autoplay:!1,editMode:!1,textAttributes:""}},mounted(){document.querySelector(".attribute-container").addEventListener("click",(e=>{e.stopPropagation()})),"auto"===this.shortcutInitMode&&this.initShortcut()},beforeDestroy(){"auto"===this.shortcutInitMode&&this.destroyShortcut()},methods:{destroyShortcut(){e.unbind("⌘+a, ctrl+a"),e.unbind("⌘+s, ctrl+s"),e.unbind("⌘+d, ctrl+d"),e.unbind("⌘+c, ctrl+c")},initShortcut(){e("⌘+a, ctrl+a",(()=>{if(this.enable)return this.createNew(),!1})),e("⌘+s, ctrl+s",(()=>{if(this.enable)return this.save(),!1})),e("⌘+d, ctrl+d",(()=>{if(this.enable)return this.remove(),!1})),e("⌘+c, ctrl+c",(()=>{if(this.enable&&this.enableBroButton)return this.copyBro(),!1}))},onClassClick(){this.localAttributes.push({key:"class",value:"class-name"})},onEventClick(){this.localAttributes.push({key:"@click",value:"onEventClick"})},onTextClick(){this.localAttributes.push({key:"__text__",value:"content"})},createNew(){this.localAttributes.push({key:"",value:""})},save(){try{let e=[];if(this.editMode){e=this.textAttributes.split("\n").map((e=>{const[t,l]=e.split(": ");return{key:t,value:l}})),this.localAttributes=e}else e=this.localAttributes.filter((e=>!!e.key));this.$emit("save",{resultList:e,lc_id:this.rawInfoID}),this.$notify({title:"提示",message:"代码已更新",position:"bottom-right",type:"success"})}catch(e){this.$message.error(e)}},remove(){this.$emit("remove",{lc_id:this.rawInfoID})},deleteItem(e){this.localAttributes.splice(e,1)},copyBro(){!function(e){let t=Object.create(e.__proto__);Object.assign(t,JSON.parse(JSON.stringify(e))),t.__proto__.parentCodeNode.__children.push(t)}(this.__rawVueInfo__),j.commit("onDragEnd")},onShow(){this.initShortcut()},onHide(){this.destroyShortcut()}},computed:{componentName(){return this.__rawVueInfo__?t(this.__rawVueInfo__):""},rawInfoID(){return this.__rawVueInfo__?l(this.__rawVueInfo__).lc_id:""},enableBroButton(){return[{name:"el-option",ifInDoc:!1},{name:"el-table-column",ifInDoc:!1},{name:"el-checkbox",ifInDoc:!0},{name:"el-radio",ifInDoc:!0}].find((e=>e.name==this.componentName))&&!1},attributeList(){const e=[],l=this.__rawVueInfo__;if(l){const a=l[t(l)];for(const t in a)if(a.hasOwnProperty(t)){const l=a[t];"object"!=typeof l&&"lc-mark"!=t&&"lc_id"!=t&&e.push({key:t,value:l})}}return e},attributeKeys(){return this.localAttributes.map((e=>e.key))}},watch:{attributeList:{handler:function(){this.localAttributes=this.attributeList},immediate:!0},localAttributes(e){0===e.length&&e.push({key:"",value:""}),this.textAttributes=e.map((e=>`${e.key}: ${e.value}`)).join("\n")}}},M=e=>(k("data-v-f08f30d6"),e=e(),g(),e),U={style:{"text-align":"center"}},F={style:{"margin-top":"20px"}},q={name:"1"},z=M((()=>p("div",{class:"split"},":",-1))),$={class:"quick-add-root"},J={style:{"margin-top":"5px"}},E={name:"2"},K={style:{"margin-top":"10px","text-align":"center"}},L=M((()=>p("div",{style:{"text-algin":"center"}},[p("span",{class:"shortcut-tip"},"支持快捷键操作")],-1)));const T=a(P,[["render",function(e,t,l,a,c,f){const k=o("lFormA"),g=o("el-divider"),j=o("el-switch"),O=o("el-input"),C=o("Remove"),V=o("el-icon"),w=o("el-tag"),A=o("Plus"),x=o("el-button"),S=o("el-tooltip"),I=o("Refresh"),D=o("Delete"),N=o("document-copy"),B=o("el-scrollbar"),R=o("el-card");return s(),b(R,{class:"attribute-container"},{default:n((()=>[r(B,{height:"calc(100vh - 130px)"},{default:n((()=>["l-form"==f.componentName?(s(),b(k,{key:0,localAttributes:e.localAttributes,"onUpdate:localAttributes":t[0]||(t[0]=t=>e.localAttributes=t),onSave:f.save},null,8,["localAttributes","onSave"])):h("",!0),r(g,{"content-position":"left"},{default:n((()=>[u("特殊处理")])),_:1}),p("div",U,[r(j,{modelValue:e.editMode,"onUpdate:modelValue":t[1]||(t[1]=t=>e.editMode=t),"active-text":"自由编辑","inactive-text":"约束编辑","active-color":"#13ce66","inactive-color":"#13ce66"},null,8,["modelValue"])]),p("div",F,[v(p("div",q,[p("div",null,[(s(!0),i(d,null,m(e.localAttributes,((e,t)=>(s(),i("div",{class:"item",key:t},[r(O,{modelValue:e.key,"onUpdate:modelValue":t=>e.key=t,placeholder:"key"+t,class:"half-width",type:"textarea",autosize:{minRows:2,maxRows:4}},null,8,["modelValue","onUpdate:modelValue","placeholder"]),z,r(O,{modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,type:"textarea",placeholder:"value"+t,class:"half-width",style:{"flex-grow":"4"},autosize:{minRows:2,maxRows:4}},null,8,["modelValue","onUpdate:modelValue","placeholder"]),r(V,{style:{"margin-left":"5px"},onClick:e=>f.deleteItem(t)},{default:n((()=>[r(C)])),_:2},1032,["onClick"])])))),128)),p("div",$,[u(" 快速增加一些属性: "),p("div",J,[r(y,{name:"el-zoom-in-center"},{default:n((()=>[-1==f.attributeKeys.indexOf("class")?(s(),b(w,{key:0,size:"small",type:"success",onClick:f.onClassClick,effect:"dark",class:"tag"},{default:n((()=>[u("Class ")])),_:1},8,["onClick"])):h("",!0)])),_:1}),r(y,{name:"el-zoom-in-center"},{default:n((()=>[-1==f.attributeKeys.indexOf("@click")?(s(),b(w,{key:0,size:"small",type:"success",onClick:f.onEventClick,effect:"dark",class:"tag"},{default:n((()=>[u("点击事件")])),_:1},8,["onClick"])):h("",!0)])),_:1}),r(y,{name:"el-zoom-in-center"},{default:n((()=>[f.attributeKeys.includes("__text__")?h("",!0):(s(),b(w,{key:0,size:"small",type:"success",onClick:f.onTextClick,effect:"dark",class:"tag"},{default:n((()=>[u("文本内容")])),_:1},8,["onClick"]))])),_:1})])])])],512),[[_,!e.editMode]]),v(p("div",E,[r(O,{type:"textarea",autosize:{minRows:4},placeholder:"请输入属性, 以key: value的形式(冒号后要有空格)",modelValue:e.textAttributes,"onUpdate:modelValue":t[2]||(t[2]=t=>e.textAttributes=t)},null,8,["modelValue"])],512),[[_,e.editMode]])]),p("div",K,[r(S,{class:"item",effect:"dark",content:"新增属性 ctrl+a",placement:"bottom"},{default:n((()=>[r(x,{type:"primary",class:"center",onClick:f.createNew,circle:""},{default:n((()=>[r(V,null,{default:n((()=>[r(A)])),_:1})])),_:1},8,["onClick"])])),_:1}),r(S,{class:"item",effect:"dark",content:"保存属性 ctrl+s",placement:"bottom"},{default:n((()=>[r(x,{type:"success",class:"center",onClick:f.save,circle:""},{default:n((()=>[r(V,null,{default:n((()=>[r(I)])),_:1})])),_:1},8,["onClick"])])),_:1}),l.enableRemoveButton?(s(),b(S,{key:0,class:"item",effect:"dark",content:"移除该组件 ctrl+d",placement:"bottom"},{default:n((()=>[r(x,{type:"danger",class:"center",onClick:f.remove,circle:""},{default:n((()=>[r(V,null,{default:n((()=>[r(D)])),_:1})])),_:1},8,["onClick"])])),_:1})):h("",!0),f.enableBroButton?(s(),b(S,{key:1,class:"item",effect:"dark",content:"复制一个兄弟组件 ctrl+c",placement:"bottom"},{default:n((()=>[r(x,{type:"primary",class:"center",onClick:f.copyBro,circle:""},{default:n((()=>[r(V,null,{default:n((()=>[r(N)])),_:1})])),_:1},8,["onClick"])])),_:1})):h("",!0),L])])),_:1})])),_:1})}],["__scopeId","data-v-f08f30d6"]]);export{T as default};
